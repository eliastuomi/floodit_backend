(this.webpackJsonpfloodit=this.webpackJsonpfloodit||[]).push([[0],{121:function(e,t,n){},122:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n(1),a=n(24),u=n.n(a),i=n(6),o=n(13),s=n(61),l=n(62),d={gameGrid:[],playerNumber:1,playerTurn:1,colorNumber:5,w:10,h:10},j=function(e){return{type:"SET_GAMESTATE",data:e}},b=function(e){return{type:"SET_GAME_VISIBLE",data:e}},h=function(e){return{type:"SET_USER",data:e}},f={gameStateReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_GAMESTATE":return t.data;default:return e}},gridReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_GRID":return t.data;default:return e}},playerTurnReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_PLAYERTURN":return t.data;default:return e}},gameVisibleReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_GAME_VISIBLE":return t.data;default:return e}},userReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USER":return t.data;default:return e}},playerNumberReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_PLAYER_NUMBER":return t.data;default:return e}},colorNumberReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_COLOR_NUMBER":return t.data;default:return e}},dimReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{w:20,h:20},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_DIM":return t.data;default:return e}}},p=Object(o.combineReducers)({gameState:f.gameStateReducer,gameGrid:f.gridReducer,playerTurn:f.playerTurnReducer,gameVisible:f.gameVisibleReducer,user:f.userReducer,playerNumber:f.playerNumberReducer,colorNumber:f.colorNumberReducer,dim:f.dimReducer}),m=Object(o.createStore)(p,Object(l.composeWithDevTools)(Object(o.applyMiddleware)(s.a))),v=n(2),O=n.n(v),g=n(3),x=n(5),y=n(7),w=n.n(y),S={login:function(){var e=Object(g.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.a.post("/api/login",t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},k={signUp:function(){var e=Object(g.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.a.post("/api/users",t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},N=n(16),T="/api/rooms",C={getAll:function(){var e=Object(g.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.a.get("".concat(T));case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),create:function(){var e=Object(g.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.a.post(T,t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),remove:function(){var e=Object(g.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.a.delete("".concat(T,"/").concat(t));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),join:function(){var e=Object(g.a)(O.a.mark((function e(t,n){var r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.a.put("".concat(T,"/").concat(t),n);case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},E=n(4),R=n(26),G=n.n(R),_=function(e){var t=Object(c.useState)([]),n=Object(x.a)(t,2),a=n[0],u=n[1],i=Object(c.useRef)();return Object(c.useEffect)((function(){return C.getAll().then((function(e){u(e.data)})).catch((function(e){console.log("fail")})),i.current=G()(),i.current.on("update_showrooms_fromserver",(function(e){console.log("CLIENT SAI P\xc4IVITYKSEN UUDESTA HUONEESTA",e),u((function(t){return[].concat(Object(N.a)(t),[e])}))})),i.current.on("update_showrooms",(function(e){u((function(t){return t.map((function(t){return t.id===e.id?e:t}))}))})),function(){return i.current.disconnect()}}),[]),Object(r.jsx)("div",{children:Object(r.jsx)("ul",{children:a.map((function(t){return Object(r.jsxs)("li",{children:[t.roomName," --- ",t.host," --- ",t.users,Object(r.jsx)("button",{onClick:function(){return e.handleJoinRoom(Object(E.a)(Object(E.a)({},t),{},{users:t.users.concat(e.userName)}))},children:"Join"})]},t.id)}))})})},I=function(e){var t=Object(c.useRef)(null),n=e.draw;Object(c.useEffect)((function(){var e=t.current.getContext("2d");n(e)}),[n]);return Object(r.jsx)("canvas",{ref:t,width:e.width,height:e.height,style:{outline:"black 2px solid",marginLeft:"2px"},children:" "})},U=(n(121),function(e){var t=Object(i.b)(),n=Object(i.c)((function(e){return e.gameState})),a=Object(i.c)((function(e){return e.gameVisible})),u=(Object(i.c)((function(e){return e.user})),Object(c.useState)([])),o=Object(x.a)(u,2),s=(o[0],o[1],e.players[n.playerTurn-1]===e.me),l=n.gameGrid?function(e,t,n){if(0===e.length)return[];for(var r=[],c=0;c<t;c++)r.push(c+1);return 1===n?r.filter((function(t){return t!==e[0][0][0]})):r.filter((function(t){return t!==e[0][0][0]&&t!==e[e.length-1][e[0].length-1][0]}))}(n.gameGrid,n.colorNumber,n.playerNumber):[],d=n.playerTurn&&1===n.playerTurn?[0,0]:[n.gameGrid[0].length-1,n.gameGrid.length-1],h=function(e,t,n){return-1!==t&&(-1!==n&&(t!==e[0].length&&n!==e.length))},f=function(e){switch(e){case 1:return"#ff3300";case 2:return"#0000ff";case 3:return"#00ff00";case 4:return"#ffff00";case 5:return"#cc00cc";case 6:return"turquoise";default:return"black"}},p=function(e,t){for(var r=[],c=[1,0],a=0;a<t;a++){r.push([]);for(var u=0;u<e;u++){var i=[1,0];c=i=Math.random()<.09&&0!==u?c:Math.random()<.09&&0!==a?[r[a-1][u][0],0]:[Math.floor(Math.random()*n.colorNumber)+1,0],r[a].push(i)}}return r},m=[],v=function e(t,r,c){return!0===m[r][t][2]?void 0:2===n.playerNumber&&0!==m[r][t][1]&&m[r][t][1]!==n.playerTurn?void(m[r][t][2]=!0):m[r][t][1]===n.playerTurn?(m[r][t][2]=!0,0!==t&&e(t-1,r,c),0!==r&&e(t,r-1,c),t!==m[0].length-1&&e(t+1,r,c),void(r!==m.length-1&&e(t,r+1,c))):m[r][t][0]===c?(m[r][t][2]=!0,m[r][t][1]=n.playerTurn,0!==t&&e(t-1,r,c),0!==r&&e(t,r-1,c),t!==m[0].length-1&&e(t+1,r,c),void(r!==m.length-1&&e(t,r+1,c))):void(m[r][t][2]=!0)},O=function(r){var c=n.gameGrid.map((function(e){return e.map((function(e){return e[1]===n.playerTurn?[r,n.playerTurn]:e}))}));m=c.map((function(e){return e.map((function(e){return[].concat(Object(N.a)(e),[!1])}))})),v(d[0],d[1],r);var a=m.map((function(e){return e.map((function(e){return[e[0],e[1]]}))})),u=Object(E.a)(Object(E.a)({},n),{},{gameGrid:a,playerTurn:1===n.playerNumber?1:1===n.playerTurn?2:1});t(j(u)),e.handleUpdate(u),0===a.map((function(e){return e.map((function(e){return e[1]}))})).flat().filter((function(e){return 0===e})).length&&alert("voitit")},g=function(){!function(r,c){var a,u=[];do{(u=p(r,c).slice(0))[0][0]=[u[0][0][0],1],2===n.playerNumber&&(u[c-1][r-1]=[u[c-1][r-1][0],2])}while((a=u)[0][0][0]===a[1][0][0]||a[0][0][0]===a[0][1][0]||2===n.playerNumber&&(a[a.length-1][a[0].length-1][0]===a[a.length-2][a[0].length-1][0]||a[a.length-1][a[0].length-1][0]===a[a.length-1][a[0].length-2][0])||2===n.playerNumber&&a[a.length-1][a[0].length-1][0]===a[0][0][0]);var i=Object(E.a)(Object(E.a)({},n),{},{gameGrid:u.slice(0),playerTurn:1});t(j(i)),e.handleUpdate(i)}(n.w,n.h),t(b(!0))},y={height:"50px",width:"50px"};return Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{style:{marginTop:"5px"},children:a?Object(r.jsxs)("div",{children:[Object(r.jsx)("button",{onClick:g,style:{float:"left"},children:"New Game!"}),Object(r.jsx)("button",{onClick:function(){t(b(!1))},style:{float:"left"},children:"Settings"})]}):Object(r.jsx)("div",{children:Object(r.jsx)("button",{onClick:g,children:"New Game!"})})}),Object(r.jsx)("div",{style:{clear:"left"}}),a?Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{children:s?l.map((function(e){return Object(r.jsx)("button",{style:Object(E.a)({marginTop:"5px",marginBottom:"6px",marginRight:"5px",backgroundColor:f(e)},y),onClick:function(){O(e)}},e)})):""}),Object(r.jsx)(I,{width:15*n.gameGrid[0].length,height:15*n.gameGrid.length,draw:function(e){e.clearRect(0,0,15*n.gameGrid[0].length,15*n.gameGrid.length);for(var t=0;t<n.gameGrid[0].length;t++)for(var r=0;r<n.gameGrid.length;r++)e.fillStyle=f(n.gameGrid[r][t][0]),e.fillRect(15*t,15*r,15,15),h(n.gameGrid,t+1,r)&&n.gameGrid[r][t][0]!==n.gameGrid[r][t+1][0]&&(e.beginPath(),e.strokeStyle="black",e.moveTo(15*t+15,15*r),e.lineTo(15*t+15,15*r+15),e.stroke(),e.closePath()),h(n.gameGrid,t,r+1)&&n.gameGrid[r][t][0]!==n.gameGrid[r+1][t][0]&&(e.beginPath(),e.strokeStyle="black",e.moveTo(15*t,15*r+15),e.lineTo(15*t+15,15*r+15),e.stroke(),e.closePath())}})]}):""]})}),L=function(e){var t=Object(i.b)(),n=Object(i.c)((function(e){return e.gameVisible})),a=Object(i.c)((function(e){return e.gameState})),u=Object(c.useState)({w:10,h:10,cn:5,pn:1}),o=Object(x.a)(u,2),s=o[0],l=o[1],d=function(e,t){"w"===t&&l(Object(E.a)(Object(E.a)({},s),{},{w:Number(e.target.value)})),"h"===t&&l(Object(E.a)(Object(E.a)({},s),{},{h:Number(e.target.value)})),"cn"===t&&l(Object(E.a)(Object(E.a)({},s),{},{cn:Number(e.target.value)})),"pn"===t&&l(Object(E.a)(Object(E.a)({},s),{},{pn:Number(e.target.value)}))},b={display:"inline-block",width:"50px"};return Object(r.jsx)("div",{children:n?"":Object(r.jsxs)("div",{children:[Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{style:b,children:"Width"}),Object(r.jsx)("input",{style:{display:"inline-block"},type:"range",min:10,max:100,value:s.w,onChange:function(e){return d(e,"w")}}),Object(r.jsx)("div",{style:{display:"inline-block"},children:s.w})]}),Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{style:b,children:"Height"}),Object(r.jsx)("input",{type:"range",min:10,max:100,value:s.h,onChange:function(e){return d(e,"h")}}),s.h]}),Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{style:b,children:"Colors"}),Object(r.jsx)("input",{type:"range",min:3,max:6,value:s.cn,onChange:function(e){return d(e,"cn")}}),s.cn]}),Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{style:b,children:"Players"}),Object(r.jsx)("input",{type:"range",min:1,max:2,value:s.pn,onChange:function(e){return d(e,"pn")}}),s.pn]}),Object(r.jsx)("div",{children:Object(r.jsx)("button",{onClick:function(){return function(){var e=Object(E.a)(Object(E.a)({},a),{},{w:s.w,h:s.h,colorNumber:s.cn,playerNumber:s.pn});t(j(e))}()},children:"Save Settings"})})]})})},A=function(e){var t=Object(i.b)(),n=Object(c.useState)(""),a=Object(x.a)(n,2),u=a[0],o=a[1],s=Object(c.useState)(""),l=Object(x.a)(s,2),d=l[0],h=l[1],f=Object(c.useState)(null),p=Object(x.a)(f,2),m=p[0],v=p[1],y=Object(c.useState)(null),w=Object(x.a)(y,2),S=w[0],k=w[1],T=Object(c.useState)(!1),E=Object(x.a)(T,2),R=E[0],I=E[1],A=Object(c.useRef)();Object(c.useEffect)((function(){return A.current=G()(),S&&B()&&A.current.emit("create",S),S&&!B()&&A.current.emit("join",{roomId:S,roomObject:m}),S&&A.current.on("update_game",(function(e){t(j(e)),t(b(!0))})),S&&A.current.on("update_room",(function(e){v(e)})),function(){S&&B()&&P(),A.current.disconnect()}}),[S]);var M=function(){var e=Object(g.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.create({userName:u});case 2:t=e.sent,v(t),k(t.id),A.current.emit("update_showrooms_toserver",t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=Object(g.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.remove(m.id);case 2:e.sent,v(null),k(null);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),J=function(){var e=Object(g.a)(O.a.mark((function e(){var t,n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={roomName:m.roomName,host:m.host,users:m.users.filter((function(e){return e!==u})),chatLog:m.chatLog},e.next=3,C.join(m.id,t);case 3:n=e.sent,A.current.emit("update_room",{roomId:n.id,roomObject:n}),v(null),k(null);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),V=function(){var e=Object(g.a)(O.a.mark((function e(){var t,n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={roomName:m.roomName,host:m.host,users:m.users,chatLog:[].concat(Object(N.a)(m.chatLog),[[u,d]])},e.next=3,C.join(m.id,t);case 3:n=e.sent,A.current.emit("update_room",{roomId:n.id,roomObject:n});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){return!(!m||m.host!==u)},D=function(){var e=Object(g.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.join(t.id,t);case 2:n=e.sent,v(n),k(n.id);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(r.jsx)("div",{children:m?Object(r.jsxs)("div",{children:[B()?Object(r.jsxs)("div",{children:["you are host in ",m.roomName,Object(r.jsx)("button",{onClick:P,children:"Leave room"}),Object(r.jsx)("div",{children:Object(r.jsx)(L,{})})]}):Object(r.jsxs)("div",{children:["you are in ",m.roomName,Object(r.jsx)("button",{onClick:function(){return J()},children:"Leave"})]}),Object(r.jsxs)("div",{children:[Object(r.jsxs)("ul",{children:[Object(r.jsx)("li",{children:"Chatti"}),m.chatLog.map((function(e){return Object(r.jsxs)("li",{children:[e[0]," sanoi: ",e[1]]},e[0]+e[1])}))]}),Object(r.jsx)("input",{placeholder:"say something",value:d,onChange:function(e){return h(e.target.value)}}),Object(r.jsx)("button",{onClick:V,children:"Send"})]}),Object(r.jsx)("div",{children:Object(r.jsx)("div",{children:Object(r.jsx)(U,{me:u,players:m.users,handleUpdate:function(e){A.current.emit("update_game",{roomId:S,gameState:e})}})})})]}):Object(r.jsx)("div",{children:R?Object(r.jsxs)("div",{children:[Object(r.jsx)(_,{handleJoinRoom:D,userName:u}),Object(r.jsx)("button",{onClick:function(){return I(!R)},children:"Hide rooms"})]}):Object(r.jsxs)("div",{children:[Object(r.jsx)("input",{placeholder:"set username",value:u,onChange:function(e){return o(e.target.value)}}),Object(r.jsx)("button",{onClick:M,children:"Create room"}),Object(r.jsx)("button",{onClick:function(){return I(!R)},children:"Show rooms"})]})})})},M=function(){var e=Object(i.b)(),t=Object(i.c)((function(e){return e.user})),n=Object(c.useState)(!1),a=Object(x.a)(n,2),u=a[0],o=a[1],s=Object(c.useState)(!1),l=Object(x.a)(s,2),d=l[0],j=l[1],b=Object(c.useState)(""),f=Object(x.a)(b,2),p=f[0],m=f[1],v=Object(c.useState)(""),y=Object(x.a)(v,2),w=y[0],N=y[1];Object(c.useEffect)((function(){var t=window.localStorage.getItem("loggedFloodItUser");if(t){var n=JSON.parse(t);e(h(n))}}),[e]);var T=function(){var t=Object(g.a)(O.a.mark((function t(n){var r;return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.prev=1,t.next=4,S.login({username:p,password:w});case 4:r=t.sent,window.localStorage.setItem("loggedFloodItUser",JSON.stringify(r)),e(h(r)),m(""),N(""),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),console.log(t.t0);case 14:case"end":return t.stop()}}),t,null,[[1,11]])})));return function(e){return t.apply(this,arguments)}}(),C=function(){var t=Object(g.a)(O.a.mark((function t(n){var r;return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.prev=1,t.next=4,k.signUp({username:p,password:w});case 4:r=t.sent,window.localStorage.setItem("loggedFloodItUser",JSON.stringify(r)),e(h(r)),m(""),N(""),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),console.log(t.t0);case 14:case"end":return t.stop()}}),t,null,[[1,11]])})));return function(e){return t.apply(this,arguments)}}();return Object(r.jsxs)("div",{children:[Object(r.jsx)(A,{}),Object(r.jsx)("div",{children:"Flood It!"}),null===t&&u&&Object(r.jsxs)("form",{onSubmit:C,children:[Object(r.jsxs)("div",{children:["username",Object(r.jsx)("input",{type:"text",value:p,name:"Username",onChange:function(e){var t=e.target;return m(t.value)}})]}),Object(r.jsxs)("div",{children:["password",Object(r.jsx)("input",{type:"password",value:w,name:"Password",onChange:function(e){var t=e.target;return N(t.value)}})]}),Object(r.jsx)("button",{type:"submit",children:"Sign Up"}),Object(r.jsx)("button",{onClick:function(){return o(!u)},children:"Cancel"})]}),null===t&&!u&&Object(r.jsx)("button",{onClick:function(){return o(!u)},children:"Sign Up"}),null===t&&d&&Object(r.jsxs)("form",{onSubmit:T,children:[Object(r.jsxs)("div",{children:["username",Object(r.jsx)("input",{type:"text",value:p,name:"Username",onChange:function(e){var t=e.target;return m(t.value)}})]}),Object(r.jsxs)("div",{children:["password",Object(r.jsx)("input",{type:"password",value:w,name:"Password",onChange:function(e){var t=e.target;return N(t.value)}})]}),Object(r.jsx)("button",{type:"submit",children:"Login"}),Object(r.jsx)("button",{onClick:function(){return j(!d)},children:"Cancel"})]}),null===t&&!d&&Object(r.jsx)("button",{onClick:function(){return j(!d)},children:"Login"}),null!==t&&Object(r.jsx)("button",{onClick:function(){return window.localStorage.clear(),void e(h(null))},children:"Log Out"})]})};u.a.render(Object(r.jsx)(i.a,{store:m,children:Object(r.jsx)(M,{})}),document.getElementById("root"))}},[[122,1,2]]]);
//# sourceMappingURL=main.fce61c2e.chunk.js.map