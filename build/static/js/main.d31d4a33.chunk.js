(this.webpackJsonpfloodit=this.webpackJsonpfloodit||[]).push([[0],{131:function(e,t,r){"use strict";r.r(t);var n=r(1),a=r(0),c=r(31),u=r.n(c),i=r(6),o=r(16),s=r(70),l=r(71),d={gameGrid:[],playerNumber:1,playerTurn:1,colorNumber:5,w:10,h:10},f=function(e){return{type:"SET_GAMESTATE",data:e}},j=function(e){return{type:"SET_GAME_VISIBLE",data:e}},b=function(e){return{type:"SET_GAME_OVER",data:e}},m=function(e){return{type:"SET_CURRENT_ROOM",data:e}},h=function(e){return{type:"SET_ROOMID",data:e}},O=function(e){return{type:"SET_SHOW_ROOMS",data:e}},p={gameStateReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_GAMESTATE":return t.data;default:return e}},gameVisibleReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_GAME_VISIBLE":return t.data;default:return e}},userReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USER":return t.data;default:return e}},currentRoomReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CURRENT_ROOM":return t.data;default:return e}},roomIdReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOMID":return t.data;default:return e}},showRoomsReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_SHOW_ROOMS":return t.data;default:return e}},gameOverReducer:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_GAME_OVER":return t.data;default:return e}}},g=Object(o.combineReducers)({gameState:p.gameStateReducer,currentRoom:p.currentRoomReducer,gameVisible:p.gameVisibleReducer,user:p.userReducer,roomId:p.roomIdReducer,showRooms:p.showRoomsReducer,gameOver:p.gameOverReducer}),v=Object(o.createStore)(g,Object(l.composeWithDevTools)(Object(o.applyMiddleware)(s.a))),x=r(7),y=r(8),w=r.n(y),S=r(10),R=r(20),N=r(15),k=r(25),T=r.n(k),_="/api/rooms",E={getAll:function(){var e=Object(S.a)(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.a.get("".concat(_));case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),create:function(){var e=Object(S.a)(w.a.mark((function e(t){var r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.a.post(_,t);case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),remove:function(){var e=Object(S.a)(w.a.mark((function e(t){var r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.a.delete("".concat(_,"/").concat(t));case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),join:function(){var e=Object(S.a)(w.a.mark((function e(t,r){var n;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.a.put("".concat(_,"/").concat(t),r);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},G=r(33),C=r.n(G),I=r(138),M=function(e){var t=Object(a.useState)([]),r=Object(N.a)(t,2),c=r[0],u=r[1],i=Object(a.useRef)();return Object(a.useEffect)((function(){return E.getAll().then((function(e){u(e.data.filter((function(e){return e.users.length<e.playerNumber})))})).catch((function(e){console.log("fail")})),i.current=C()(),i.current.on("new_availableroom",(function(e){u((function(t){return[].concat(Object(R.a)(t),[e]).filter((function(e){return e.users.length<e.playerNumber}))}))})),i.current.on("updated_availableroom",(function(e){u((function(t){return t.map((function(t){return t.id===e.id?e:t})).filter((function(e){return e.users.length<e.playerNumber}))}))})),i.current.on("remove_availableroom",(function(e){u((function(t){return t.filter((function(t){return t.id!==e}))}))})),function(){return i.current.disconnect()}}),[]),Object(n.jsx)("div",{children:Object(n.jsx)("ul",{children:c.map((function(t){return Object(n.jsxs)("li",{children:[t.roomName,", dimensions:",t.w,"x",t.h,", colors:",t.colorNumber,Object(n.jsx)(I.a,{variant:"primary",onClick:function(){return e.handleJoinRoom(Object(x.a)(Object(x.a)({},t),{},{users:t.users.concat(e.nickName)}))},children:"Join"})]},t.id)}))})})},L=r(137),A=r(132),B=function(e){var t=Object(i.b)(),r=Object(i.c)((function(e){return e.gameState})),c=Object(a.useState)({w:10,h:10,cn:5,pn:1}),u=Object(N.a)(c,2),o=u[0],s=u[1];Object(a.useEffect)((function(){s({w:r.w,h:r.h,cn:r.colorNumber,pn:r.playerNumber})}),[r]);var l=function(e,t){"w"===t&&s(Object(x.a)(Object(x.a)({},o),{},{w:Number(e.target.value)})),"h"===t&&s(Object(x.a)(Object(x.a)({},o),{},{h:Number(e.target.value)})),"cn"===t&&s(Object(x.a)(Object(x.a)({},o),{},{cn:Number(e.target.value)})),"pn"===t&&s(Object(x.a)(Object(x.a)({},o),{},{pn:Number(e.target.value)}))};return Object(n.jsxs)("div",{children:[Object(n.jsxs)("div",{children:[Object(n.jsxs)(L.a.Group,{controlId:"formBasicRange",children:[Object(n.jsx)(L.a.Label,{children:"Width"}),Object(n.jsx)(A.a,{className:"float-sm-right",variant:"primary",children:o.w}),Object(n.jsx)(L.a.Control,{type:"range",min:10,max:100,value:o.w,onChange:function(e){return l(e,"w")}})]}),Object(n.jsxs)(L.a.Group,{controlId:"formBasicRange",children:[Object(n.jsx)(L.a.Label,{children:"Height"}),Object(n.jsx)(A.a,{className:"float-sm-right",variant:"primary",children:o.h}),Object(n.jsx)(L.a.Control,{type:"range",min:10,max:100,value:o.h,onChange:function(e){return l(e,"h")}})]}),Object(n.jsxs)(L.a.Group,{controlId:"formBasicRange",children:[Object(n.jsxs)(L.a.Label,{children:["Colors ",o.cn]}),Object(n.jsx)(L.a.Control,{type:"range",min:3,max:6,value:o.cn,onChange:function(e){return l(e,"cn")}})]}),Object(n.jsxs)(L.a.Group,{controlId:"formBasicRange",children:[Object(n.jsxs)(L.a.Label,{children:["Players ",o.pn]}),Object(n.jsx)(L.a.Control,{type:"range",min:1,max:2,value:o.pn,onChange:function(e){return l(e,"pn")}})]})]}),Object(n.jsx)("div",{children:r.w!==o.w||r.h!==o.h||r.playerNumber!==o.pn||r.colorNumber!==o.cn?Object(n.jsx)(I.a,{variant:"outline-primary",block:!0,onClick:function(){return function(){var e=Object(x.a)(Object(x.a)({},r),{},{w:o.w,h:o.h,colorNumber:o.cn,playerNumber:o.pn});t(f(e))}()},children:"Save Settings"}):""})]})},H=function(e){var t=Object(i.c)((function(e){return e.gameState})),r=Object(a.useRef)(null),c=10,u=function(e){switch(e){case 1:return"#ff3300";case 2:return"#0000ff";case 3:return"#00ff00";case 4:return"#ffff00";case 5:return"#cc00cc";case 6:return"turquoise";default:return"black"}},o=function(e,t,r){return-1!==t&&(-1!==r&&(t!==e[0].length&&r!==e.length))};Object(a.useEffect)((function(){!function(e){e.clearRect(0,0,t.gameGrid[0].length*c,t.gameGrid.length*c);for(var r=0;r<t.gameGrid[0].length;r++)for(var n=0;n<t.gameGrid.length;n++)e.fillStyle=u(t.gameGrid[n][r][0]),e.fillRect(r*c,n*c,c,c),o(t.gameGrid,r+1,n)&&t.gameGrid[n][r][0]!==t.gameGrid[n][r+1][0]&&(e.beginPath(),e.strokeStyle="black",e.moveTo(r*c+c,n*c),e.lineTo(r*c+c,n*c+c),e.stroke(),e.closePath()),o(t.gameGrid,r,n+1)&&t.gameGrid[n][r][0]!==t.gameGrid[n+1][r][0]&&(e.beginPath(),e.strokeStyle="black",e.moveTo(r*c,n*c+c),e.lineTo(r*c+c,n*c+c),e.stroke(),e.closePath())}(r.current.getContext("2d"))}),[t]);return Object(n.jsx)("canvas",{ref:r,width:t.gameGrid[0].length*c,height:t.gameGrid.length*c,style:{outline:"black 2px solid",display:"block",marginLeft:"auto",marginRight:"auto"},children:" "})},V=function(e){var t=Object(i.c)((function(e){return e.gameState})),r=t.gameGrid?function(e,t,r){if(0===e.length)return[];for(var n=[],a=0;a<t;a++)n.push(a+1);return 1===r?n.filter((function(t){return t!==e[0][0][0]})):n.filter((function(t){return t!==e[0][0][0]&&t!==e[e.length-1][e[0].length-1][0]}))}(t.gameGrid,t.colorNumber,t.playerNumber):[],a=function(e){switch(e){case 1:return"#ff3300";case 2:return"#0000ff";case 3:return"#00ff00";case 4:return"#ffff00";case 5:return"#cc00cc";case 6:return"turquoise";default:return"black"}},c={height:"50px",width:"50px",textAlect:"center"};return Object(n.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:r.map((function(t){return Object(n.jsx)("button",{style:Object(x.a)({backgroundColor:e.clickable?a(t):"grey"},c),disabled:!e.clickable,onClick:function(){return e.playTurnButtonHandler(t)}},t)}))})},U=r(139),J=function(e){var t=Object(i.c)((function(e){return e.gameState})),r=Object(i.c)((function(e){return e.currentRoom})),a=function(e){switch(e){case 0:return"success";case 1:return"danger";default:return"info"}};return Object(n.jsx)("div",{children:function(){for(var e=[],r=0;r<t.playerNumber;r++){e.push([0,r]);for(var n=0;n<t.gameGrid[0].length;n++)for(var a=0;a<t.gameGrid.length;a++)t.gameGrid[a][n][1]===r+1&&(e[r]=[e[r][0]+1,e[r][1]])}var c=t.gameGrid[0].length*t.gameGrid.length;return e.map((function(e){return[e[0]/c,e[1]]}))}().map((function(e){return Object(n.jsx)(U.a,{animated:!0,variant:a(e[1]),now:100*e[0]*t.playerNumber,label:r.users[e[1]]},e[1])}))})},D=r(133),P=r(72),W=function(e){var t=Object(i.b)(),r=Object(i.c)((function(e){return e.gameState})),a=Object(i.c)((function(e){return e.gameVisible})),c=Object(i.c)((function(e){return e.currentRoom})),u=Object(i.c)((function(e){return e.gameOver})),o=c.users[r.playerTurn-1],s=r.playerTurn&&1===r.playerTurn?[0,0]:[r.gameGrid[0].length-1,r.gameGrid.length-1],l=function(e,t){for(var n=[],a=[1,0],c=0;c<t;c++){n.push([]);for(var u=0;u<e;u++){var i=[1,0];a=i=Math.random()<.09&&0!==u?a:Math.random()<.09&&0!==c?[n[c-1][u][0],0]:[Math.floor(Math.random()*r.colorNumber)+1,0],n[c].push(i)}}return n},d=function(e){var t=e.map((function(e){return e.map((function(e){return e[1]}))})).flat(),n=r.gameGrid[0].length*r.gameGrid.length;if(0===t.filter((function(e){return 0===e})).length){if(2===r.playerNumber){for(var a=function(e){if(t.filter((function(t){return t===e+1})).length/n>.5)return{v:c.users[e]}},u=0;u<r.playerNumber;u++){var i=a(u);if("object"===typeof i)return i.v}return"tie"}return"won"}return""},j=[],b=function e(t,n,a){return!0===j[n][t][2]?void 0:2===r.playerNumber&&0!==j[n][t][1]&&j[n][t][1]!==r.playerTurn?void(j[n][t][2]=!0):j[n][t][1]===r.playerTurn?(j[n][t][2]=!0,0!==t&&e(t-1,n,a),0!==n&&e(t,n-1,a),t!==j[0].length-1&&e(t+1,n,a),void(n!==j.length-1&&e(t,n+1,a))):j[n][t][0]===a?(j[n][t][2]=!0,j[n][t][1]=r.playerTurn,0!==t&&e(t-1,n,a),0!==n&&e(t,n-1,a),t!==j[0].length-1&&e(t+1,n,a),void(n!==j.length-1&&e(t,n+1,a))):void(j[n][t][2]=!0)},m=function(n){var a=r.gameGrid.map((function(e){return e.map((function(e){return e[1]===r.playerTurn?[n,r.playerTurn]:e}))}));j=a.map((function(e){return e.map((function(e){return[].concat(Object(R.a)(e),[!1])}))})),b(s[0],s[1],n);var c=j.map((function(e){return e.map((function(e){return[e[0],e[1]]}))})),u=Object(x.a)(Object(x.a)({},r),{},{gameGrid:c,playerTurn:1===r.playerNumber?1:1===r.playerTurn?2:1});switch(t(f(u)),e.handleUpdate(u),d(c)){case"":break;case"tie":e.gameOver("Draw!");break;case"won":e.gameOver("You won!");break;default:e.gameOver(d(c)+"won")}};return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(D.a,{children:Object(n.jsx)(P.a,{md:{span:4,offset:4},children:u&&e.isHost?Object(n.jsx)(I.a,{variant:"outline-danger",block:!0,onClick:function(){!function(n,a){var c,u=[];do{(u=l(n,a).slice(0))[0][0]=[u[0][0][0],1],2===r.playerNumber&&(u[a-1][n-1]=[u[a-1][n-1][0],2])}while((c=u)[0][0][0]===c[1][0][0]||c[0][0][0]===c[0][1][0]||2===r.playerNumber&&(c[c.length-1][c[0].length-1][0]===c[c.length-2][c[0].length-1][0]||c[c.length-1][c[0].length-1][0]===c[c.length-1][c[0].length-2][0])||2===r.playerNumber&&c[c.length-1][c[0].length-1][0]===c[0][0][0]);var i=Object(x.a)(Object(x.a)({},r),{},{gameGrid:u.slice(0),playerTurn:1});t(f(i)),e.handleStart(i)}(r.w,r.h)},children:"Start game!"}):""})}),a?Object(n.jsxs)("div",{children:[Object(n.jsx)(D.a,{children:Object(n.jsxs)(P.a,{md:{span:4,offset:4},children:[2===r.playerNumber?Object(n.jsx)(A.a,{variant:"danger",children:o}):"",u?"":Object(n.jsx)(V,{playTurnButtonHandler:function(e){m(e)},clickable:o===e.me})]})}),Object(n.jsx)(D.a,{children:Object(n.jsx)(P.a,{children:Object(n.jsx)(H,{})})}),Object(n.jsx)(D.a,{children:Object(n.jsx)(P.a,{md:{span:4,offset:4},children:Object(n.jsx)(J,{})})})]}):""]})},F=r(134),q=r(135),z=function(e){var t=Object(a.useState)(""),r=Object(N.a)(t,2),c=r[0],u=r[1];return Object(n.jsxs)("div",{children:[Object(n.jsx)("h3",{children:"Chat"}),Object(n.jsx)(F.a,{children:Object(n.jsx)("tbody",{children:e.chatLog.map((function(e){return Object(n.jsxs)("tr",{children:[Object(n.jsxs)("td",{children:[e.sender," sanoi:"]}),Object(n.jsx)("td",{children:e.message})]},e.id)}))})}),Object(n.jsxs)(q.a,{className:"mb-3",children:[Object(n.jsx)(L.a.Control,{"aria-describedby":"basic-addon1",placeholder:"say something",value:c,onChange:function(e){u(e.target.value)}}),Object(n.jsx)(q.a.Append,{children:Object(n.jsx)(I.a,{variant:"outline-secondary",onClick:function(){e.handleSendChat(c),u("")},children:"Send"})})]})]})},Y=function(e){var t=Object(i.b)(),r=Object(i.c)((function(e){return e.currentRoom})),c=Object(i.c)((function(e){return e.roomId})),u=Object(i.c)((function(e){return e.showRooms})),o=Object(i.c)((function(e){return e.gameState})),s=Object(a.useState)(""),l=Object(N.a)(s,2),d=l[0],p=l[1],g=Object(a.useState)([]),v=Object(N.a)(g,2),y=v[0],k=v[1],T=Object(a.useRef)();Object(a.useEffect)((function(){return T.current=C()(),c&&U()&&T.current.emit("create",c),c&&!U()&&T.current.emit("join",{roomId:c,roomObject:r}),c&&!U()&&T.current.on("leave_host",(function(e){t(m(null)),t(h(null)),t(b(!0)),t(j(!1)),t(O(!1)),alert("host left")})),c&&U()&&T.current.on("leave_room",(function(e){t(b(!0)),t(j(!1)),t(m(e)),alert("player left")})),c&&T.current.on("update_game",(function(e){t(f(e))})),c&&T.current.on("game_over",(function(e){t(b(!0)),alert(e)})),c&&T.current.on("send_message",(function(e){k((function(t){return[].concat(Object(R.a)(t),[e])}))})),c&&T.current.on("start_game",(function(e){t(f(e)),t(j(!0)),t(b(!1))})),c&&T.current.on("update_room",(function(e){t(m(e))})),c&&window.addEventListener("beforeunload",(function(){return _()})),function(){c&&window.removeEventListener("beforeunload",(function(){return _(c)})),T.current.disconnect()}}),[c]);var _=function(e){U()&&A(),!U()&&H()},G=function(){var e=Object(S.a)(w.a.mark((function e(){var r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.create({nickName:d,w:o.w,h:o.h,colorNumber:o.colorNumber,playerNumber:o.playerNumber});case 2:r=e.sent,t(m(r)),t(h(r.id)),T.current.emit("new_availableroom",r);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=Object(S.a)(w.a.mark((function e(){var n;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.remove(r.id);case 2:n=e.sent,t(m(null)),t(h(null)),t(b(!0)),t(j(!1)),T.current.emit("leave_host",{roomId:n.id});case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),H=function(){var e=Object(S.a)(w.a.mark((function e(){var n,a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(x.a)(Object(x.a)({},r),{},{users:r.users.filter((function(e){return e!==d}))}),e.next=3,E.join(r.id,n);case 3:a=e.sent,T.current.emit("leave_room",{roomId:a.id,roomObject:a}),T.current.emit("new_availableroom",a),t(m(null)),t(h(null)),t(b(!0)),t(j(!1));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),V=function(){var e=Object(S.a)(w.a.mark((function e(r){var n;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.join(r.id,r);case 2:n=e.sent,t(m(n)),t(h(n.id));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=function(){return!(!r||r.host!==d)},J=function(){t(O(!u))};return Object(n.jsx)("div",{children:r?Object(n.jsxs)("div",{children:[Object(n.jsx)(D.a,{children:Object(n.jsxs)(P.a,{md:{span:4,offset:4},children:[Object(n.jsxs)("p",{className:"text-center",children:["Host: ",r.users[0]]}),Object(n.jsxs)("p",{className:"text-center",children:["Room: ",r.roomName]}),Object(n.jsx)(z,{handleSendChat:function(e){var t={sender:d,message:e,id:y.length+1};T.current.emit("send_message",{roomId:c,chatObject:t})},chatLog:y}),U()?Object(n.jsx)("div",{children:Object(n.jsx)(I.a,{size:"sm",variant:"outline-primary",block:!0,onClick:function(){return A()},children:"Leave room"})}):Object(n.jsx)("div",{children:Object(n.jsx)(I.a,{size:"sm",variant:"outline-primary",block:!0,onClick:function(){return H()},children:"Leave"})})]})}),Object(n.jsx)("div",{children:r.users.length===r.playerNumber?Object(n.jsx)("div",{children:Object(n.jsx)(W,{me:d,handleUpdate:function(e){T.current.emit("update_game",{roomId:c,gameState:e})},handleStart:function(e){T.current.emit("start_game",{roomId:c,gameState:e})},isHost:U(),gameOver:function(e){T.current.emit("game_over",{roomId:c,text:e})}})}):""})]}):Object(n.jsx)(D.a,{children:Object(n.jsx)(P.a,{md:{span:4,offset:4},children:Object(n.jsx)("div",{children:u?Object(n.jsxs)("div",{children:[Object(n.jsx)(M,{handleJoinRoom:V,nickName:d}),Object(n.jsx)(I.a,{variant:"primary",onClick:J,children:"Hide rooms"})]}):Object(n.jsxs)("div",{children:[Object(n.jsx)("div",{children:Object(n.jsx)(L.a.Control,{value:d,placeholder:"set username",onChange:function(e){return p(e.target.value)}})}),Object(n.jsx)("div",{children:""!==d?Object(n.jsx)(I.a,{variant:"outline-primary",block:!0,onClick:G,children:"Create room"}):""}),Object(n.jsxs)("div",{children:[""!==d?Object(n.jsx)(I.a,{variant:"outline-primary",block:!0,onClick:J,children:"Show rooms"}):"",Object(n.jsx)(B,{})]})]})})})})})},K=r(136),Q=function(){var e=Object(i.b)();return Object(a.useEffect)((function(){var t=window.localStorage.getItem("loggedFloodItUser");if(t){var r=JSON.parse(t);e({type:"SET_USER",data:r})}}),[e]),Object(n.jsxs)(K.a,{fluid:!0,children:[Object(n.jsx)(D.a,{children:Object(n.jsx)(P.a,{md:{span:4,offset:4},children:Object(n.jsx)("h1",{className:"text-center",children:Object(n.jsx)(A.a,{variant:"primary",children:"FLOOD IT"})})})}),Object(n.jsx)(Y,{})]})};u.a.render(Object(n.jsx)(i.a,{store:v,children:Object(n.jsx)(Q,{})}),document.getElementById("root"))}},[[131,1,2]]]);
//# sourceMappingURL=main.d31d4a33.chunk.js.map